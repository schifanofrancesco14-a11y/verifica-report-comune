<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Verifica documento protocollato</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
    }
    .ok { color: green; font-weight: bold; }
    .err { color: red; font-weight: bold; }
    .box {
      border: 1px solid #ccc;
      padding: 15px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>Verifica documento protocollato</h1>

<div id="esito">Verifica in corso…</div>

<script>
const params = new URLSearchParams(window.location.search);
const protocollo = params.get('prot');

if (!protocollo) {
  document.getElementById('esito').innerHTML =
    '<p class="err">Errore: protocollo mancante</p>';
  throw new Error('Protocollo mancante');
}

fetch('registro_protocollo.csv')
  .then(r => r.text())
  .then(csv => {
    const righe = csv.trim().split('\n').slice(1);

    for (const riga of righe) {
      const campi = riga.split(',');

      if (campi[0] === protocollo) {
        document.getElementById('esito').innerHTML = `
          <p class="ok">✔️ Documento valido</p>
          <div class="box">
            <p><strong>Protocollo:</strong> ${campi[0]}</p>
            <p><strong>Data:</strong> ${campi[1]}</p>
            <p><strong>ODS:</strong> ${campi[2]}</p>
            <p><strong>Tecnico:</strong> ${campi[3]}</p>
            <p><strong>File:</strong> ${campi[4]}</p>
            <p><strong>Stato:</strong> ${campi[7]}</p>
          </div>
        `;
        return;
      }
    }

    document.getElementById('esito').innerHTML =
      '<p class="err">❌ Documento non trovato nel registro pubblico</p>';
  })
  .catch(() => {
    document.getElementById('esito').innerHTML =
      '<p class="err">Errore di lettura del registro</p>';
  });
</script>

</body>
</html>
